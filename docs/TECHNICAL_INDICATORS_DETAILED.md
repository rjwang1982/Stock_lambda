# 📊 股票技术分析系统 - 技术指标详解

**作者**: RJ.Wang  
**邮箱**: wangrenjun@gmail.com  
**创建时间**: 2025-11-12  
**版本**: 1.0

---

## 📑 目录

1. [系统概述](#系统概述)
2. [数据获取流程](#数据获取流程)
3. [技术指标详解](#技术指标详解)
4. [评分系统](#评分系统)
5. [实战案例](#实战案例)
6. [API 使用指南](#api-使用指南)


---

## 🎯 系统概述

本系统是一个基于 AWS Lambda 的无服务器股票技术分析平台，通过计算多种技术指标，为投资者提供量化的投资建议。

### 核心特性

```
┌─────────────────────────────────────────────────────────┐
│                    股票分析系统架构                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  用户请求 → API Gateway → Lambda → AKShare → 数据处理    │
│                                    ↓                    │
│                              技术指标计算                 │
│                                    ↓                    │
│                              综合评分                     │
│                                    ↓                    │
│                              投资建议                     │
│                                    ↓                    │
│                              JSON 响应                   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 支持的市场

| 市场类型 | 代码示例 | 说明 |
|---------|---------|------|
| 🇨🇳 A股 | 600519, 000001 | 沪深股票 |
| 🇭🇰 港股 | 00700, 09988 | 香港股票 |
| 🇺🇸 美股 | AAPL, TSLA | 美国股票 |
| 📈 ETF | 510300, 159915 | 交易型基金 |
| 📊 LOF | 163406, 161725 | 上市开放式基金 |

### 技术栈

- **数据源**: AKShare (开源金融数据接口)
- **计算引擎**: Pandas + NumPy
- **部署平台**: AWS Lambda (Serverless)
- **API 网关**: Amazon API Gateway
- **架构**: arm64 (Graviton2)


---

## 🔄 数据获取流程

### 第一步：数据源连接

使用 **AKShare** 开源金融数据接口库：

```python
import akshare as ak

# AKShare 特点：
# ✅ 完全免费
# ✅ 数据实时更新
# ✅ 支持多市场
# ✅ 无需 API Key
```

### 第二步：获取原始数据

#### A股数据获取

```python
# 获取贵州茅台(600519)近一年数据
df = ak.stock_zh_a_hist(
    symbol="600519",           # 股票代码
    start_date="20240101",     # 开始日期
    end_date="20241231",       # 结束日期
    adjust="qfq"               # 前复权
)
```

#### 港股数据获取

```python
# 获取腾讯控股(00700)数据
df = ak.stock_hk_daily(
    symbol="00700",
    adjust="qfq"
)
```

#### 美股数据获取

```python
# 获取苹果(AAPL)数据
df = ak.stock_us_hist(
    symbol="AAPL",
    start_date="20240101",
    end_date="20241231",
    adjust="qfq"
)
```

#### ETF/LOF 基金数据获取

```python
# 获取沪深300ETF数据
df = ak.fund_etf_hist_em(
    symbol="510300",
    period="daily",
    start_date="20240101",
    end_date="20241231",
    adjust="qfq"
)
```

### 第三步：原始数据结构

获取的数据包含以下字段：

| 字段名 | 说明 | 示例 |
|-------|------|------|
| 日期 | 交易日期 | 2024-01-02 |
| 开盘 | 开盘价 | 1650.0 |
| 收盘 | 收盘价 | 1658.5 |
| 最高 | 最高价 | 1670.0 |
| 最低 | 最低价 | 1645.0 |
| 成交量 | 成交量 | 45,230 |
| 成交额 | 成交金额 | 7,500,000 |

### 第四步：数据标准化

```python
def standardize_dataframe(df):
    """标准化数据格式"""
    
    # 1. 统一列名（支持中英文）
    column_mapping = {
        "日期": "date",
        "开盘": "open", 
        "收盘": "close",
        "最高": "high",
        "最低": "low",
        "成交量": "volume"
    }
    df = df.rename(columns=column_mapping)
    
    # 2. 数据类型转换
    numeric_columns = ['open', 'close', 'high', 'low', 'volume']
    for col in numeric_columns:
        df[col] = pd.to_numeric(df[col], errors='coerce')
    
    # 3. 日期格式转换
    df['date'] = pd.to_datetime(df['date'])
    
    # 4. 数据清洗
    df = df.dropna()  # 删除空值
    df = df.sort_values('date')  # 按日期排序
    
    return df
```

**标准化后的数据示例**：

| date | open | close | high | low | volume |
|------|------|-------|------|-----|--------|
| 2024-01-02 | 1650.0 | 1658.5 | 1670.0 | 1645.0 | 45230 |
| 2024-01-03 | 1660.0 | 1655.0 | 1665.0 | 1650.0 | 38120 |
| 2024-01-04 | 1655.0 | 1670.5 | 1675.0 | 1652.0 | 52340 |


---

## 📈 技术指标详解

### 1️⃣ 移动平均线 (MA - Moving Average)

#### 📖 原理说明

移动平均线是将一定时期内的价格平均值连成线，用于：
- 平滑价格波动
- 识别趋势方向
- 判断支撑和阻力位

#### 🧮 计算公式

**指数移动平均 (EMA)**：

```
EMA(t) = Price(t) × K + EMA(t-1) × (1-K)

其中：
  K = 2 / (N + 1)
  N = 周期数
  
示例（5日EMA）：
  K = 2 / (5 + 1) = 0.333
  EMA(今日) = 收盘价 × 0.333 + EMA(昨日) × 0.667
```

#### 💻 代码实现

```python
def calculate_ema(series, period):
    """
    计算指数移动平均线
    
    Args:
        series: 价格序列 (pd.Series)
        period: 周期数 (int)
    
    Returns:
        EMA 序列 (pd.Series)
    
    示例:
        >>> df['MA5'] = calculate_ema(df['close'], 5)
        >>> df['MA20'] = calculate_ema(df['close'], 20)
        >>> df['MA60'] = calculate_ema(df['close'], 60)
    """
    return series.ewm(span=period, adjust=False).mean()

# 在系统中的应用
df['MA5'] = calculate_ema(df['close'], 5)    # 短期趋势（1周）
df['MA20'] = calculate_ema(df['close'], 20)  # 中期趋势（1月）
df['MA60'] = calculate_ema(df['close'], 60)  # 长期趋势（3月）
```

#### 📊 图示说明

```
价格
 │
 │     ╱╲    ╱╲         ← 价格波动（实际价格）
 │    ╱  ╲  ╱  ╲╱╲
 │   ╱    ╲╱      ╲    ← MA5 (短期均线)
 │  ╱              ╲   ← MA20 (中期均线)
 │ ╱                ╲  ← MA60 (长期均线)
 │╱
 └────────────────────→ 时间

均线特点：
- 周期越短，越贴近价格，反应越灵敏
- 周期越长，越平滑，反应越迟钝
```

#### 🎯 应用策略

| 信号类型 | 条件 | 含义 | 操作建议 | 可靠度 |
|---------|------|------|---------|--------|
| 🟢 金叉 | MA5 上穿 MA20 | 短期趋势转强 | 买入信号 | ⭐⭐⭐ |
| 🔴 死叉 | MA5 下穿 MA20 | 短期趋势转弱 | 卖出信号 | ⭐⭐⭐ |
| 🟢 多头排列 | MA5 > MA20 > MA60 | 强势上涨趋势 | 持有/加仓 | ⭐⭐⭐⭐ |
| 🔴 空头排列 | MA5 < MA20 < MA60 | 弱势下跌趋势 | 减仓/观望 | ⭐⭐⭐⭐ |
| 🔵 均线粘合 | MA5 ≈ MA20 ≈ MA60 | 趋势不明，酝酿突破 | 等待方向 | ⭐⭐ |

#### 📌 实战案例

**贵州茅台 (600519) - 2024年10月数据分析**

```
日期        收盘价    MA5      MA20     MA60     趋势判断
──────────────────────────────────────────────────────
2024-10-20  1458.70  1459.15  1458.44  1459.82  MA5 > MA20 ✓ 短期向上
2024-10-21  1467.98  1462.09  1459.35  1460.09  多头排列形成
2024-10-22  1450.00  1458.06  1458.46  1459.76  短期回调
2024-10-23  1440.41  1452.18  1456.74  1459.12  MA5 < MA20 ✗ 转弱
2024-10-24  1445.00  1449.78  1455.62  1458.66  继续走弱
2024-11-10  1453.48  1438.98  1442.79  1452.04  空头排列

分析结论：
- 10月20-21日：短期金叉，买入信号
- 10月22日后：死叉形成，趋势转弱
- 11月10日：空头排列，建议观望
```

#### 💡 使用技巧

1. **趋势确认**：等待价格站稳均线上方再买入
2. **支撑阻力**：均线常作为支撑位和阻力位
3. **背离信号**：价格创新高但均线未跟上，警惕回调
4. **周期配合**：结合多个周期均线提高准确率


---

### 2️⃣ RSI (相对强弱指数 - Relative Strength Index)

#### 📖 原理说明

RSI 是一个动量振荡指标，通过比较一段时期内价格上涨和下跌的幅度，来判断：
- 市场的超买超卖状态
- 价格反转的可能性
- 趋势的强弱程度

**核心思想**：如果上涨天数多且涨幅大，RSI 值高（超买）；如果下跌天数多且跌幅大，RSI 值低（超卖）。

#### 🧮 计算公式

```
步骤1：计算价格变化
  ΔPrice = Price(t) - Price(t-1)

步骤2：分离涨跌
  Gain = ΔPrice (if ΔPrice > 0, else 0)
  Loss = |ΔPrice| (if ΔPrice < 0, else 0)

步骤3：计算平均涨跌幅（默认14日）
  Avg Gain = Average(Gain, 14)
  Avg Loss = Average(Loss, 14)

步骤4：计算相对强度
  RS = Avg Gain / Avg Loss

步骤5：计算 RSI
  RSI = 100 - (100 / (1 + RS))
  
  或者：RSI = 100 × (Avg Gain / (Avg Gain + Avg Loss))

示例计算：
  假设14日平均涨幅 = 2.5，平均跌幅 = 1.5
  RS = 2.5 / 1.5 = 1.67
  RSI = 100 - (100 / (1 + 1.67)) = 62.5
```

#### 💻 代码实现

```python
def calculate_rsi(series, period=14):
    """
    计算 RSI 指标
    
    Args:
        series: 价格序列 (pd.Series)
        period: 周期数 (int, 默认14)
    
    Returns:
        RSI 序列 (pd.Series), 值域 [0, 100]
    
    示例:
        >>> df['RSI'] = calculate_rsi(df['close'], 14)
        >>> print(f"当前RSI: {df['RSI'].iloc[-1]:.2f}")
    """
    # 计算价格变化
    delta = series.diff()
    
    # 分离涨跌
    gain = delta.where(delta > 0, 0)  # 上涨部分
    loss = -delta.where(delta < 0, 0)  # 下跌部分（取绝对值）
    
    # 计算平均涨跌幅
    avg_gain = gain.rolling(window=period).mean()
    avg_loss = loss.rolling(window=period).mean()
    
    # 计算 RS 和 RSI
    rs = avg_gain / avg_loss
    rsi = 100 - (100 / (1 + rs))
    
    return rsi

# 在系统中的应用
df['RSI'] = calculate_rsi(df['close'], period=14)
```

#### 📊 图示说明

```
RSI
100 ├─────────────────────────────────
    │    ⚠️  超买区域 (>70)
    │    价格可能回调
 70 ├─────────────────────────────────
    │    ╱╲      ╱╲
    │   ╱  ╲    ╱  ╲    
 50 ├──╱────╲──╱────╲─── ← 中性线
    │         ╲╱      ╲   正常区域
 30 ├─────────────────╲──────────────
    │    ⚠️  超卖区域 (<30)
    │    价格可能反弹
  0 ├─────────────────────────────────
    └────────────────────────→ 时间

RSI 特点：
- 值域：0-100
- 中性线：50
- 超买线：70
- 超卖线：30
```

#### 🎯 应用策略

| RSI 区间 | 市场状态 | 含义 | 操作建议 | 风险提示 |
|---------|---------|------|---------|---------|
| 🔴 > 80 | 极度超买 | 严重超买，高位风险 | 考虑止盈 | ⚠️⚠️⚠️ |
| 🟠 70-80 | 超买 | 上涨过快，可能回调 | 谨慎追高 | ⚠️⚠️ |
| 🟢 50-70 | 强势 | 上涨趋势健康 | 持有观察 | ✓ |
| 🔵 30-50 | 弱势 | 下跌趋势或盘整 | 观望等待 | ⚠️ |
| 🟢 20-30 | 超卖 | 下跌过快，可能反弹 | 关注买点 | ✓ |
| 🟢 < 20 | 极度超卖 | 严重超卖，反弹机会 | 分批建仓 | ✓✓ |

#### 📌 实战案例

**贵州茅台 (600519) - RSI 分析**

```
日期        收盘价    涨跌幅    RSI      状态      操作建议
────────────────────────────────────────────────────
2024-10-20  1458.70  -0.24%   54.61    正常区域   持有
2024-10-21  1467.98  +0.64%   57.74    正常偏强   持有
2024-10-22  1450.00  -1.22%   53.73    正常区域   持有
2024-10-23  1440.41  -0.66%   44.47    正常偏弱   观察
2024-10-24  1445.00  +0.32%   50.29    中性      等待
2024-10-25  1431.90  -0.91%   48.63    正常偏弱   观察
2024-10-26  1426.74  -0.36%   49.08    正常偏弱   观察
2024-10-27  1420.08  -0.62%   23.78    超卖 ⚠️   关注买点
2024-10-28  1435.13  +1.06%   40.86    反弹中    观察确认
2024-11-10  1453.48  +1.41%   46.44    正常区域   持有

分析结论：
- 10月27日：RSI跌破30，进入超卖区域，出现买入机会
- 10月28日：RSI回升至40+，超卖反弹确认
- 11月10日：RSI回归正常区域，短期反弹结束

交易策略：
✓ 在RSI<30时分批买入
✓ 在RSI>70时考虑减仓
✗ 避免在RSI极值区域追涨杀跌
```

#### 💡 高级应用

**1. RSI 背离**

```
价格背离：
- 顶背离：价格创新高，RSI未创新高 → 上涨乏力，警惕回调
- 底背离：价格创新低，RSI未创新低 → 下跌乏力，关注反弹

示例：
  日期      价格    RSI
  Day 1    100     65
  Day 2    105     68  ← 价格新高
  Day 3    110     66  ← RSI未新高（顶背离）
  结果：随后价格回调
```

**2. RSI 趋势线**

```
在RSI图上画趋势线：
- RSI突破下降趋势线 → 买入信号
- RSI跌破上升趋势线 → 卖出信号
```

**3. RSI 与其他指标配合**

```
RSI + MACD：
  RSI < 30 且 MACD金叉 → 强烈买入信号
  RSI > 70 且 MACD死叉 → 强烈卖出信号

RSI + 均线：
  RSI < 30 且价格站上MA20 → 超卖反弹确认
  RSI > 70 且价格跌破MA20 → 超买回调确认
```

#### ⚠️ 使用注意事项

1. **趋势市场中的失效**：
   - 强势上涨时，RSI可能长期>70
   - 强势下跌时，RSI可能长期<30
   - 此时不应机械地按超买超卖操作

2. **周期选择**：
   - 短线：使用6-9日RSI
   - 中线：使用14日RSI（默认）
   - 长线：使用21-28日RSI

3. **市场环境**：
   - 牛市：超买信号不可靠，关注超卖
   - 熊市：超卖信号不可靠，关注超买
   - 震荡市：超买超卖信号最可靠


---

### 3️⃣ MACD (指数平滑异同移动平均线)

#### 📖 原理说明

MACD 是一个趋势跟踪动量指标，通过快慢两条移动平均线的差值来判断：
- 趋势的方向和强度
- 买卖时机的选择
- 趋势反转的信号

**核心思想**：快线反应灵敏，慢线反应迟钝，两者的差值（MACD）可以提前反映趋势变化。

#### 🧮 计算公式

```
步骤1：计算快线 (DIF)
  DIF = EMA(12) - EMA(26)
  
步骤2：计算慢线/信号线 (DEA/Signal)
  DEA = EMA(DIF, 9)
  
步骤3：计算柱状图 (Histogram)
  MACD Hist = DIF - DEA

参数说明：
  12：快线周期（短期）
  26：慢线周期（长期）
  9：信号线周期

示例计算：
  假设 EMA(12) = 1450, EMA(26) = 1440
  DIF = 1450 - 1440 = 10
  假设 DIF的9日EMA = 8
  DEA = 8
  MACD Hist = 10 - 8 = 2
```

#### 💻 代码实现

```python
def calculate_macd(series):
    """
    计算 MACD 指标
    
    Args:
        series: 价格序列 (pd.Series)
    
    Returns:
        macd: MACD 线 (DIF)
        signal: 信号线 (DEA)
        hist: 柱状图 (Histogram)
    
    示例:
        >>> macd, signal, hist = calculate_macd(df['close'])
        >>> df['MACD'] = macd
        >>> df['Signal'] = signal
        >>> df['MACD_hist'] = hist
    """
    # 快线：12日EMA
    exp1 = series.ewm(span=12, adjust=False).mean()
    
    # 慢线：26日EMA
    exp2 = series.ewm(span=26, adjust=False).mean()
    
    # MACD 线 (DIF) = 快线 - 慢线
    macd = exp1 - exp2
    
    # 信号线 (DEA)：MACD 的 9日EMA
    signal = macd.ewm(span=9, adjust=False).mean()
    
    # 柱状图 = MACD - 信号线
    hist = macd - signal
    
    return macd, signal, hist

# 在系统中的应用
df['MACD'], df['Signal'], df['MACD_hist'] = calculate_macd(df['close'])
```

#### 📊 图示说明

```
MACD
  │
  │    ╱╲         ← MACD 线 (DIF) - 快速反应
  │   ╱  ╲  ╱╲
  │  ╱    ╲╱  ╲   ← Signal 线 (DEA) - 平滑信号
──┼─╱──────────╲─────────  ← 零轴
  │╱            ╲
  │              ╲
  │  ║║║║║║║║║║║║  ← 柱状图 (Histogram)
  │  ↑金叉  ↑死叉
  └────────────────→ 时间

柱状图含义：
  正值：MACD > Signal，上涨动能
  负值：MACD < Signal，下跌动能
  柱子变长：动能增强
  柱子变短：动能减弱
```

#### 🎯 应用策略

| 信号类型 | 条件 | 含义 | 操作建议 | 可靠度 |
|---------|------|------|---------|--------|
| 🟢 金叉 | MACD 上穿 Signal | 上涨动能增强 | 买入信号 | ⭐⭐⭐⭐ |
| 🔴 死叉 | MACD 下穿 Signal | 下跌动能增强 | 卖出信号 | ⭐⭐⭐⭐ |
| 🟢 零轴上金叉 | MACD>0 且金叉 | 强势上涨确认 | 强烈买入 | ⭐⭐⭐⭐⭐ |
| 🔴 零轴下死叉 | MACD<0 且死叉 | 弱势下跌确认 | 强烈卖出 | ⭐⭐⭐⭐⭐ |
| 🟢 柱状图增长 | Hist 正值增大 | 上涨加速 | 持有/加仓 | ⭐⭐⭐ |
| 🔴 柱状图缩短 | Hist 负值增大 | 下跌加速 | 减仓/离场 | ⭐⭐⭐ |

#### 📌 实战案例

**贵州茅台 (600519) - MACD 分析**

```
日期        收盘价    MACD     Signal   Hist     信号判断
──────────────────────────────────────────────────────────
2024-10-20  1458.70  -2.41    -4.05    +1.65    金叉趋势形成
2024-10-21  1467.98  -1.35    -3.51    +2.17    金叉确认 ✓
2024-10-22  1450.00  -1.93    -3.20    +1.26    动能减弱
2024-10-23  1440.41  -3.14    -3.18    +0.05    接近死叉
2024-10-24  1445.00  -3.68    -3.28    -0.40    死叉形成 ✗
2024-10-25  1431.90  -5.11    -3.65    -1.46    下跌加速
2024-10-26  1426.74  -6.58    -4.23    -2.34    继续走弱
2024-10-27  1420.08  -8.07    -4.87    -3.20    跌势确立
2024-10-28  1435.13  -7.40    -5.40    -2.00    跌势减缓
2024-11-10  1453.48  -6.27    -7.04    +0.77    金叉形成 ✓

分析结论：
- 10月21日：零轴下金叉，短期反弹信号
- 10月24日：死叉形成，趋势转弱
- 11月10日：再次金叉，新一轮反弹开始

交易策略：
✓ 金叉买入：10月21日、11月10日
✗ 死叉卖出：10月24日
```

#### 💡 高级应用

**1. MACD 背离**

```
顶背离（看跌信号）：
  价格：创新高
  MACD：未创新高或下降
  → 上涨动能衰竭，警惕回调

底背离（看涨信号）：
  价格：创新低
  MACD：未创新低或上升
  → 下跌动能衰竭，关注反弹

示例：
  日期      价格    MACD
  Day 1    100     5.0
  Day 2    105     6.0
  Day 3    110     5.5  ← 价格新高，MACD未新高（顶背离）
  结果：随后价格回调至100以下
```

**2. MACD 零轴策略**

```
零轴上方（MACD > 0）：
  - 多头市场
  - 金叉：强烈买入
  - 死叉：短期调整

零轴下方（MACD < 0）：
  - 空头市场
  - 金叉：反弹机会
  - 死叉：继续下跌

零轴穿越：
  - 上穿零轴：趋势转多
  - 下穿零轴：趋势转空
```

**3. 柱状图分析**

```
柱状图变化规律：
  
  正值区域：
    ║║║║║║ → ║║║║ → ║║ → ║
    增长     缩短     即将死叉
    
  负值区域：
    ║ → ║║ → ║║║║ → ║║║║║║
    缩短     增长     下跌加速
    
操作要点：
  - 柱状图由负转正：买入信号
  - 柱状图由正转负：卖出信号
  - 柱状图持续增长：持有
  - 柱状图开始缩短：警惕反转
```

#### ⚠️ 使用注意事项

1. **滞后性**：
   - MACD 是趋势跟踪指标，有一定滞后
   - 适合中长线操作，不适合短线交易

2. **震荡市场**：
   - 横盘震荡时，MACD 频繁金叉死叉
   - 容易产生虚假信号
   - 建议配合趋势指标使用

3. **参数调整**：
   - 短线：(6, 13, 5)
   - 中线：(12, 26, 9) - 默认
   - 长线：(19, 39, 9)


---

### 4️⃣ 布林带 (Bollinger Bands)

#### 📖 原理说明

布林带是一个基于统计学的技术指标，通过标准差来衡量价格的波动范围：
- 判断价格的相对高低
- 识别超买超卖状态
- 预测价格突破方向

**核心思想**：价格在大部分时间内会在布林带范围内波动，触及上下轨时可能反转或突破。

#### 🧮 计算公式

```
步骤1：计算中轨 (Middle Band)
  MB = MA(Close, 20)  # 20日移动平均

步骤2：计算标准差 (Standard Deviation)
  σ = √[Σ(Close - MA)² / N]

步骤3：计算上轨 (Upper Band)
  UB = MB + (K × σ)  # K通常为2

步骤4：计算下轨 (Lower Band)
  LB = MB - (K × σ)

示例计算：
  假设20日均价 = 1450
  标准差 = 15
  上轨 = 1450 + (2 × 15) = 1480
  下轨 = 1450 - (2 × 15) = 1420
  
  价格在 [1420, 1480] 区间内波动属于正常
```

#### 💻 代码实现

```python
def calculate_bollinger_bands(series, period=20, std_dev=2):
    """
    计算布林带
    
    Args:
        series: 价格序列 (pd.Series)
        period: 周期数 (int, 默认20)
        std_dev: 标准差倍数 (float, 默认2)
    
    Returns:
        upper: 上轨
        middle: 中轨
        lower: 下轨
    
    示例:
        >>> upper, middle, lower = calculate_bollinger_bands(df['close'])
        >>> df['BB_upper'] = upper
        >>> df['BB_middle'] = middle
        >>> df['BB_lower'] = lower
    """
    # 中轨：移动平均线
    middle = series.rolling(window=period).mean()
    
    # 标准差
    std = series.rolling(window=period).std()
    
    # 上轨和下轨
    upper = middle + (std * std_dev)
    lower = middle - (std * std_dev)
    
    return upper, middle, lower

# 在系统中的应用
df['BB_upper'], df['BB_middle'], df['BB_lower'] = calculate_bollinger_bands(
    df['close'], 
    period=20, 
    std_dev=2
)
```

#### 📊 图示说明

```
价格
  │
  │  ╱‾‾‾‾‾‾‾‾‾‾‾╲     ← 上轨 (超买区域)
  │ ╱    ╱╲  ╱╲   ╲      价格触及可能回调
  │╱────╱──╲╱──╲───╲   ← 中轨 (均线)
  │    ╱        ╲   ╲     价格围绕中轨波动
  │   ╱          ╲   ╲  ← 下轨 (超卖区域)
  │  ╱            ╲___╲    价格触及可能反弹
  └────────────────────→ 时间
  
  ├─窄─┤  ├───宽───┤
  低波动   高波动
  
布林带特征：
- 带宽收窄：波动率降低，酝酿突破
- 带宽扩张：波动率增加，趋势明确
- 价格沿上轨：强势上涨
- 价格沿下轨：弱势下跌
```

#### 🎯 应用策略

| 位置关系 | 含义 | 操作建议 | 适用场景 |
|---------|------|---------|---------|
| 🔴 突破上轨 | 超买，可能回调 | 考虑减仓 | 震荡市 |
| 🟢 突破上轨 | 强势突破 | 持有/加仓 | 趋势市 |
| 🟢 触及下轨 | 超卖，可能反弹 | 考虑买入 | 震荡市 |
| 🔴 跌破下轨 | 弱势破位 | 止损离场 | 趋势市 |
| 🔵 在中轨附近 | 价格正常波动 | 持有观察 | 所有市场 |
| ⚠️ 布林带收窄 | 波动率降低 | 等待突破 | 突破前夕 |
| ⚠️ 布林带扩张 | 波动率增加 | 顺势操作 | 趋势确立 |

#### 📌 实战案例

**贵州茅台 (600519) - 布林带分析**

```
日期        收盘价    上轨     中轨     下轨     位置判断
────────────────────────────────────────────────────────
2024-10-20  1458.70  1489.09  1453.42  1417.75  中轨上方
2024-10-21  1467.98  1483.48  1452.17  1420.85  接近上轨
2024-10-22  1450.00  1481.69  1451.27  1420.84  回落至中轨
2024-10-23  1440.41  1479.62  1449.89  1420.16  跌破中轨
2024-10-24  1445.00  1479.23  1449.47  1419.71  中轨下方
2024-10-25  1431.90  1479.47  1448.70  1417.92  接近下轨
2024-10-26  1426.74  1479.97  1447.93  1415.89  触及下轨 ⚠️
2024-10-27  1420.08  1479.62  1446.49  1413.37  跌破下轨 ✗
2024-10-28  1435.13  1479.97  1446.61  1413.26  反弹至下轨
2024-11-10  1453.48  1479.62  1446.49  1413.37  回到中轨

分析结论：
- 10月21日：接近上轨，超买信号
- 10月26-27日：触及并跌破下轨，超卖信号
- 10月28日后：从下轨反弹，超卖修复

交易策略：
✓ 在下轨附近买入（10月26-27日）
✓ 在上轨附近减仓（10月21日）
✗ 避免在中轨附近追涨杀跌
```

#### 💡 高级应用

**1. 布林带宽度 (Bandwidth)**

```python
# 计算布林带宽度
bandwidth = (upper - lower) / middle * 100

宽度含义：
  > 10%：高波动，趋势明确
  5-10%：正常波动
  < 5%：低波动，即将突破（布林带收口）

操作策略：
  - 宽度极窄时：准备突破，关注方向
  - 宽度扩张时：趋势确立，顺势操作
  - 宽度收窄时：趋势结束，准备反转
```

**2. 布林带%B指标**

```python
# 计算价格在布林带中的位置
percent_b = (close - lower) / (upper - lower)

%B 含义：
  > 1.0：价格在上轨之上（超买）
  0.8-1.0：接近上轨（偏强）
  0.5：在中轨（中性）
  0.2-0.0：接近下轨（偏弱）
  < 0：价格在下轨之下（超卖）
```

**3. 布林带突破策略**

```
突破上轨：
  震荡市：超买，考虑卖出
  上升趋势：强势突破，持有
  
  判断方法：
  - 成交量放大 + 突破上轨 = 真突破
  - 成交量萎缩 + 突破上轨 = 假突破

突破下轨：
  震荡市：超卖，考虑买入
  下降趋势：弱势破位，止损
  
  判断方法：
  - 恐慌性放量 + 跌破下轨 = 可能见底
  - 持续缩量 + 跌破下轨 = 继续下跌
```

**4. 布林带收口突破**

```
收口特征：
  - 上下轨距离缩小
  - 波动率降低
  - 价格横盘整理

突破方向判断：
  1. 观察成交量：放量方向为突破方向
  2. 观察均线：均线多头排列向上突破
  3. 观察MACD：金叉向上，死叉向下

操作要点：
  - 收口期间：观望等待
  - 突破确认：顺势跟进
  - 假突破：快速止损
```

#### ⚠️ 使用注意事项

1. **市场环境**：
   - 震荡市：布林带上下轨是有效的支撑阻力
   - 趋势市：价格可能沿着上轨或下轨运行

2. **参数调整**：
   - 短线：(10, 1.5)
   - 中线：(20, 2) - 默认
   - 长线：(50, 2.5)

3. **配合使用**：
   - 布林带 + RSI：双重确认超买超卖
   - 布林带 + MACD：确认突破方向
   - 布林带 + 成交量：验证突破真实性


---

### 5️⃣ 成交量分析 (Volume Analysis)

#### 📖 原理说明

成交量是市场活跃度和资金关注度的直接体现：
- 价格变动的动力来源
- 趋势强弱的验证工具
- 反转信号的确认指标

**核心思想**：量在价先，成交量的变化往往领先于价格变化。

#### 🧮 计算公式

```
步骤1：计算成交量移动平均
  Volume_MA = MA(Volume, 20)

步骤2：计算成交量比率
  Volume_Ratio = Volume / Volume_MA

步骤3：判断量能状态
  Volume_Ratio > 2.0  → 巨量
  Volume_Ratio > 1.5  → 放量
  Volume_Ratio > 1.0  → 活跃
  Volume_Ratio < 1.0  → 缩量
  Volume_Ratio < 0.5  → 地量

示例计算：
  今日成交量 = 50,000手
  20日平均成交量 = 30,000手
  Volume_Ratio = 50,000 / 30,000 = 1.67 (放量)
```

#### 💻 代码实现

```python
def calculate_volume_analysis(df, period=20):
    """
    计算成交量分析指标
    
    Args:
        df: 包含成交量的数据框
        period: 周期数 (int, 默认20)
    
    Returns:
        添加了成交量指标的数据框
    
    示例:
        >>> df = calculate_volume_analysis(df, period=20)
        >>> print(f"成交量比率: {df['Volume_Ratio'].iloc[-1]:.2f}")
    """
    # 成交量移动平均
    df['Volume_MA'] = df['volume'].rolling(window=period).mean()
    
    # 成交量比率
    df['Volume_Ratio'] = df['volume'] / df['Volume_MA']
    
    return df

# 在系统中的应用
df['Volume_MA'] = df['volume'].rolling(window=20).mean()
df['Volume_Ratio'] = df['volume'] / df['Volume_MA']
```

#### 📊 图示说明

```
成交量
  │
  │     ║║║              ← 巨量 (>2.0)
  │  ║║ ║║║ ║║           ← 放量 (1.5-2.0)
  │  ║║ ║║║ ║║ ║         ← 活跃 (1.0-1.5)
  │  ║║ ║║║ ║║ ║ ║  ─── ← 平均线
  │  ║║ ║║║ ║║ ║ ║       ← 缩量 (0.5-1.0)
  │  ║║ ║║║ ║║ ║ ║  ║    ← 地量 (<0.5)
  └────────────────────→ 时间

价格
  │    ╱╲  ╱╲
  │   ╱  ╲╱  ╲
  │  ╱        ╲
  └────────────────────→ 时间
  
量价关系：
  价涨量增 ✓ 健康上涨
  价涨量缩 ⚠️ 上涨乏力
  价跌量增 ✗ 恐慌下跌
  价跌量缩 ✓ 下跌衰竭
```

#### 🎯 量价关系分析

| 价格 | 成交量 | 含义 | 操作建议 | 可靠度 |
|-----|-------|------|---------|--------|
| 🟢 ↑ | 🟢 ↑ | 健康上涨，资金推动 | 持有/加仓 | ⭐⭐⭐⭐⭐ |
| 🟡 ↑ | 🔴 ↓ | 上涨乏力，警惕回调 | 谨慎持有 | ⭐⭐⭐⭐ |
| 🔴 ↓ | 🟢 ↑ | 恐慌性下跌或洗盘 | 观望/抄底 | ⭐⭐⭐ |
| 🟢 ↓ | 🔴 ↓ | 下跌动能衰竭 | 关注反弹 | ⭐⭐⭐⭐ |
| 🔵 → | 🔴 ↓ | 横盘缩量，酝酿突破 | 等待方向 | ⭐⭐⭐ |
| 🔵 → | 🟢 ↑ | 横盘放量，即将突破 | 准备跟进 | ⭐⭐⭐⭐ |

#### 📌 实战案例

**贵州茅台 (600519) - 成交量分析**

```
日期        收盘价   涨跌幅   成交量   Volume_MA  Volume_Ratio  量价关系
──────────────────────────────────────────────────────────────────
2024-10-20  1458.70  -0.24%   18,195   39,447     0.46         价跌量缩 ✓
2024-10-21  1467.98  +0.64%   29,322   39,396     0.74         价涨量增 ✓
2024-10-22  1450.00  -1.22%   38,226   38,821     0.98         价跌量增 ⚠️
2024-10-23  1440.41  -0.66%   37,102   39,045     0.95         价跌量平 ⚠️
2024-10-24  1445.00  +0.32%   27,124   38,653     0.70         价涨量缩 ⚠️
2024-10-25  1431.90  -0.91%   33,937   38,417     0.88         价跌量缩 ✓
2024-10-26  1426.74  -0.36%   47,456   39,253     1.21         价跌量增 ✗
2024-10-27  1430.01  +0.23%   35,694   39,344     0.91         价涨量缩 ⚠️
2024-10-28  1435.13  +1.06%   34,548   38,815     0.89         价涨量缩 ⚠️
2024-10-29  1429.00  -0.42%   26,566   37,459     0.71         价跌量缩 ✓
2024-10-30  1420.08  -0.62%   34,475   37,215     0.93         价跌量平 ⚠️
2024-11-10  1453.48  +1.41%   24,279   34,440     0.70         价涨量缩 ⚠️

分析结论：
- 10月21日：价涨量增，健康上涨
- 10月22-23日：价跌量增，恐慌性下跌
- 10月26日：放量下跌，可能见底
- 11月10日：价涨量缩，反弹乏力

交易策略：
✓ 10月26日放量下跌后关注反弹
⚠️ 11月10日反弹缩量，不宜追高
```

#### 💡 高级应用

**1. 天量天价，地量地价**

```
天量天价：
  - 价格创新高 + 成交量创新高
  - 含义：多头力量耗尽，可能见顶
  - 操作：考虑获利了结

地量地价：
  - 价格创新低 + 成交量创新低
  - 含义：空头力量耗尽，可能见底
  - 操作：关注抄底机会

注意：
  - 天量不一定天价（可能是换手）
  - 地量不一定地价（可能继续下跌）
  - 需要结合其他指标确认
```

**2. 突破放量**

```
向上突破：
  - 价格突破阻力位
  - 成交量明显放大（>1.5倍）
  - 含义：真突破，趋势确立
  - 操作：跟进买入

向下突破：
  - 价格跌破支撑位
  - 成交量明显放大
  - 含义：真破位，趋势转弱
  - 操作：止损离场

缩量突破：
  - 价格突破但成交量未放大
  - 含义：假突破，可能回落
  - 操作：观望等待确认
```

**3. 堆量和缩量**

```
堆量（成交量持续放大）：
  上涨堆量：主力吸筹，看涨
  下跌堆量：主力出货，看跌
  横盘堆量：主力建仓，关注突破

缩量（成交量持续萎缩）：
  上涨缩量：惜售，继续看涨
  下跌缩量：抛压减轻，可能见底
  横盘缩量：观望情绪浓，等待催化
```

**4. OBV 能量潮指标**

```python
def calculate_obv(df):
    """计算 OBV 指标"""
    obv = []
    obv_value = 0
    
    for i in range(len(df)):
        if i == 0:
            obv_value = df['volume'].iloc[i]
        else:
            if df['close'].iloc[i] > df['close'].iloc[i-1]:
                obv_value += df['volume'].iloc[i]  # 上涨累加
            elif df['close'].iloc[i] < df['close'].iloc[i-1]:
                obv_value -= df['volume'].iloc[i]  # 下跌累减
        obv.append(obv_value)
    
    return pd.Series(obv, index=df.index)

# OBV 应用：
# - OBV 上升：资金流入
# - OBV 下降：资金流出
# - OBV 与价格背离：警惕反转
```

---

### 6️⃣ ATR (平均真实波幅) 与波动率

#### 📖 原理说明

ATR 衡量价格波动的幅度，用于：
- 评估市场的波动性
- 设置止损位置
- 判断风险水平

**核心思想**：波动越大，风险越高；波动越小，风险越低。

#### 🧮 计算公式

```
步骤1：计算真实波幅 (True Range)
  TR = MAX(
      High - Low,              # 当日最高-最低
      |High - Close(t-1)|,     # 当日最高-昨收
      |Low - Close(t-1)|       # 当日最低-昨收
  )

步骤2：计算平均真实波幅
  ATR = MA(TR, 14)

步骤3：计算波动率
  Volatility = (ATR / Close) × 100%

示例计算：
  今日最高 = 1470, 最低 = 1450, 昨收 = 1460
  TR1 = 1470 - 1450 = 20
  TR2 = |1470 - 1460| = 10
  TR3 = |1450 - 1460| = 10
  TR = MAX(20, 10, 10) = 20
  
  假设14日平均TR = 18
  ATR = 18
  Volatility = (18 / 1460) × 100% = 1.23%
```

#### 💻 代码实现

```python
def calculate_atr(df, period=14):
    """
    计算 ATR 指标
    
    Args:
        df: 包含 high, low, close 的数据框
        period: 周期数 (int, 默认14)
    
    Returns:
        atr: ATR 序列
        volatility: 波动率序列 (%)
    """
    high = df['high']
    low = df['low']
    close_prev = df['close'].shift(1)
    
    # 计算三种真实波幅
    tr1 = high - low
    tr2 = abs(high - close_prev)
    tr3 = abs(low - close_prev)
    
    # 取最大值
    tr = pd.concat([tr1, tr2, tr3], axis=1).max(axis=1)
    
    # 计算平均
    atr = tr.rolling(window=period).mean()
    
    # 计算波动率
    volatility = (atr / df['close']) * 100
    
    return atr, volatility

# 在系统中的应用
df['ATR'] = calculate_atr(df, period=14)[0]
df['Volatility'] = calculate_atr(df, period=14)[1]
```

#### 🎯 应用策略

| 波动率 | 风险等级 | 市场状态 | 操作建议 |
|-------|---------|---------|---------|
| 🔴 > 3% | 高风险 | 剧烈波动 | 减小仓位，扩大止损 |
| 🟡 2-3% | 中风险 | 正常波动 | 正常操作 |
| 🟢 1-2% | 低风险 | 平稳运行 | 可适当加仓 |
| 🔵 < 1% | 极低风险 | 波动极小 | 关注突破，缩小止损 |

#### 💡 ATR 止损应用

```
动态止损设置：
  
  保守型：
    止损位 = 买入价 - (1.5 × ATR)
  
  中性型：
    止损位 = 买入价 - (2 × ATR)
  
  激进型：
    止损位 = 买入价 - (3 × ATR)

示例：
  买入价 = 1450
  ATR = 20
  
  保守止损 = 1450 - (1.5 × 20) = 1420
  中性止损 = 1450 - (2 × 20) = 1410
  激进止损 = 1450 - (3 × 20) = 1390
```

---

### 7️⃣ ROC (变动率指标)

#### 📖 原理说明

ROC 衡量价格在一定时期内的变化百分比，反映价格变动的速度和动量。

#### 🧮 计算公式

```
ROC = [(Price(t) - Price(t-n)) / Price(t-n)] × 100%

其中：n = 周期（默认10日）

示例计算：
  今日价格 = 1450
  10日前价格 = 1400
  ROC = [(1450 - 1400) / 1400] × 100% = +3.57%
```

#### 💻 代码实现

```python
def calculate_roc(series, period=10):
    """
    计算 ROC 指标
    
    Args:
        series: 价格序列
        period: 周期数 (默认10)
    
    Returns:
        ROC 序列 (百分比)
    """
    roc = series.pct_change(periods=period) * 100
    return roc

# 在系统中的应用
df['ROC'] = df['close'].pct_change(periods=10) * 100
```

#### 🎯 应用策略

| ROC 值 | 含义 | 操作建议 |
|-------|------|---------|
| 🟢 > +10% | 极强势上涨 | 警惕回调 |
| 🟢 +5% ~ +10% | 强势上涨 | 持有/加仓 |
| 🔵 0 ~ +5% | 温和上涨 | 持有观察 |
| 🟡 -5% ~ 0 | 温和下跌 | 谨慎持有 |
| 🔴 -10% ~ -5% | 快速下跌 | 考虑减仓 |
| 🔴 < -10% | 极弱势下跌 | 止损离场 |


---

## 🎯 综合评分系统

### 评分规则（满分100分）

我们的系统通过多维度技术指标综合评分，为投资者提供量化的投资建议。

```
┌─────────────────────────────────────────┐
│          综合评分系统架构                  │
├─────────────────────────────────────────┤
│                                         │
│  📊 趋势得分 (30分)                       │
│  ├─ MA5 > MA20 → +15分                  │
│  └─ MA20 > MA60 → +15分                 │
│                                         │
│  📈 RSI 得分 (20分)                      │
│  ├─ 30 ≤ RSI ≤ 70 → +20分               │
│  └─ RSI < 30 → +15分 (超卖机会)          │
│                                         │
│  📉 MACD 得分 (20分)                     │
│  └─ MACD > Signal → +20分 (金叉)        │
│                                         │
│  📊 成交量得分 (30分)                     │
│  ├─ Volume_Ratio > 1.5 → +30分          │
│  └─ Volume_Ratio > 1.0 → +15分          │
│                                         │
│  🎯 总分 = 各项得分之和 (0-100)           │
│                                         │
└─────────────────────────────────────────┘
```

### 评分逻辑详解

#### 1. 趋势得分 (30分)

```python
def calculate_trend_score(latest):
    """计算趋势得分"""
    score = 0
    
    # 短期趋势 (15分)
    if latest['MA5'] > latest['MA20']:
        score += 15  # 短期向上
    
    # 中期趋势 (15分)
    if latest['MA20'] > latest['MA60']:
        score += 15  # 中期向上
    
    return score

评分说明：
  30分：多头排列，强势上涨 (MA5 > MA20 > MA60)
  15分：短期或中期向上
  0分：空头排列，弱势下跌
```

#### 2. RSI 得分 (20分)

```python
def calculate_rsi_score(latest):
    """计算 RSI 得分"""
    rsi = latest['RSI']
    
    if 30 <= rsi <= 70:
        return 20  # 正常区域，健康运行
    elif rsi < 30:
        return 15  # 超卖区域，反弹机会
    else:
        return 0   # 超买区域，回调风险

评分说明：
  20分：RSI 在正常区域 (30-70)
  15分：RSI 超卖 (<30)，潜在买入机会
  0分：RSI 超买 (>70)，警惕回调
```

#### 3. MACD 得分 (20分)

```python
def calculate_macd_score(latest):
    """计算 MACD 得分"""
    if latest['MACD'] > latest['Signal']:
        return 20  # 金叉，上涨动能
    else:
        return 0   # 死叉，下跌动能

评分说明：
  20分：MACD 金叉，上涨趋势
  0分：MACD 死叉，下跌趋势
```

#### 4. 成交量得分 (30分)

```python
def calculate_volume_score(latest):
    """计算成交量得分"""
    ratio = latest['Volume_Ratio']
    
    if ratio > 1.5:
        return 30  # 放量，资金积极
    elif ratio > 1.0:
        return 15  # 活跃，正常交易
    else:
        return 0   # 缩量，观望情绪

评分说明：
  30分：放量 (>1.5倍)，资金积极参与
  15分：活跃 (>1.0倍)，正常交易
  0分：缩量 (<1.0倍)，观望情绪浓厚
```

### 投资建议映射

```python
def get_recommendation(score):
    """
    根据评分给出投资建议
    
    Args:
        score: 综合评分 (0-100)
    
    Returns:
        投资建议字符串
    """
    if score >= 80:
        return '🟢 强烈推荐买入'
    elif score >= 60:
        return '🟢 建议买入'
    elif score >= 40:
        return '🟡 观望'
    elif score >= 20:
        return '🔴 建议卖出'
    else:
        return '🔴 强烈建议卖出'
```

### 评分等级说明

| 分数区间 | 等级 | 含义 | 建议 | 风险提示 |
|---------|------|------|------|---------|
| 🟢 80-100 | 优秀 | 多项指标向好，强势上涨 | 强烈推荐买入 | 注意高位风险 |
| 🟢 60-79 | 良好 | 大部分指标向好，上涨趋势 | 建议买入 | 适度控制仓位 |
| 🟡 40-59 | 中性 | 指标分化，方向不明 | 观望等待 | 等待明确信号 |
| 🔴 20-39 | 较差 | 大部分指标转弱，下跌趋势 | 建议卖出 | 及时止损 |
| 🔴 0-19 | 很差 | 多项指标恶化，弱势下跌 | 强烈建议卖出 | 严格止损 |

### 评分案例分析

**案例1：贵州茅台 (600519) - 2024-11-10**

```
技术指标：
  MA5: 1438.98
  MA20: 1442.79
  MA60: 1452.04
  RSI: 46.44
  MACD: -6.27
  Signal: -7.04
  Volume_Ratio: 0.70

评分计算：
  趋势得分：0分 (MA5 < MA20 < MA60，空头排列)
  RSI得分：20分 (46.44 在正常区域)
  MACD得分：20分 (MACD > Signal，金叉)
  成交量得分：0分 (0.70 < 1.0，缩量)
  
  总分：40分

投资建议：🟡 观望
  
分析：
  - 均线空头排列，趋势偏弱
  - MACD金叉，短期有反弹
  - 成交量不足，上涨动能有限
  - 综合判断：短期反弹，中期观望
```

**案例2：理想状态 - 满分100分**

```
技术指标：
  MA5 > MA20 > MA60 (多头排列)
  RSI: 55 (正常区域)
  MACD > Signal (金叉)
  Volume_Ratio: 1.8 (放量)

评分计算：
  趋势得分：30分 ✓
  RSI得分：20分 ✓
  MACD得分：20分 ✓
  成交量得分：30分 ✓
  
  总分：100分

投资建议：🟢 强烈推荐买入

分析：
  - 所有指标完美配合
  - 趋势、动量、资金全面向好
  - 这是最理想的买入时机
```

---

## 📱 API 使用指南

### 快速开始

#### 1. API 端点

```
生产环境：
https://z4jpb59h5g.execute-api.cn-northwest-1.amazonaws.com.cn/prod/

可用端点：
  GET  /health              # 健康检查
  GET  /                    # 服务状态
  GET  /test-stock/{code}   # 快速测试
  POST /analyze-stock       # 完整分析
```

#### 2. 认证方式

```http
Authorization: Bearer YOUR_TOKEN

当前有效Token：
  8uB32ZB6ZqZVpwZV
```

#### 3. 请求示例

**Python 示例**：

```python
import requests
import json

# API 配置
API_URL = "https://z4jpb59h5g.execute-api.cn-northwest-1.amazonaws.com.cn/prod/analyze-stock"
TOKEN = "8uB32ZB6ZqZVpwZV"

# 请求头
headers = {
    "Authorization": f"Bearer {TOKEN}",
    "Content-Type": "application/json"
}

# 请求数据
data = {
    "stock_code": "600519",
    "market_type": "A",
    "start_date": "20240101",  # 可选
    "end_date": "20241231"      # 可选
}

# 发送请求
response = requests.post(API_URL, headers=headers, json=data)
result = response.json()

# 解析结果
if result['success']:
    report = result['data']['report']
    print(f"股票代码: {report['stock_code']}")
    print(f"当前价格: {report['price']}")
    print(f"技术评分: {report['score']}")
    print(f"投资建议: {report['recommendation']}")
    print(f"\n技术指标:")
    for key, value in report['technical_indicators'].items():
        print(f"  {key}: {value}")
else:
    print(f"错误: {result['error']}")
```

**cURL 示例**：

```bash
curl -X POST "https://z4jpb59h5g.execute-api.cn-northwest-1.amazonaws.com.cn/prod/analyze-stock" \
  -H "Authorization: Bearer 8uB32ZB6ZqZVpwZV" \
  -H "Content-Type: application/json" \
  -d '{
    "stock_code": "600519",
    "market_type": "A"
  }'
```

**JavaScript 示例**：

```javascript
const API_URL = 'https://z4jpb59h5g.execute-api.cn-northwest-1.amazonaws.com.cn/prod/analyze-stock';
const TOKEN = '8uB32ZB6ZqZVpwZV';

async function analyzeStock(stockCode, marketType = 'A') {
  try {
    const response = await fetch(API_URL, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${TOKEN}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        stock_code: stockCode,
        market_type: marketType
      })
    });
    
    const result = await response.json();
    
    if (result.success) {
      const report = result.data.report;
      console.log(`股票代码: ${report.stock_code}`);
      console.log(`当前价格: ${report.price}`);
      console.log(`技术评分: ${report.score}`);
      console.log(`投资建议: ${report.recommendation}`);
    } else {
      console.error(`错误: ${result.error}`);
    }
  } catch (error) {
    console.error('请求失败:', error);
  }
}

// 使用示例
analyzeStock('600519', 'A');
```

### 响应格式

```json
{
  "success": true,
  "timestamp": "2025-11-12T07:43:54.153256",
  "data": {
    "technical_summary": {
      "trend": "downward",
      "volatility": "1.17%",
      "volume_trend": "decreasing",
      "rsi_level": 46.44
    },
    "recent_data": [
      {
        "date": "2025-11-10T00:00:00",
        "open": 1435.0,
        "close": 1453.48,
        "high": 1455.0,
        "low": 1434.98,
        "volume": 24279,
        "MA5": 1438.98,
        "MA20": 1442.79,
        "MA60": 1452.04,
        "RSI": 46.44,
        "MACD": -6.27,
        "Signal": -7.04
      }
    ],
    "report": {
      "stock_code": "600519",
      "market_type": "A",
      "analysis_date": "2025-11-10",
      "score": 40,
      "price": 1453.48,
      "price_change": 1.41,
      "ma_trend": "DOWN",
      "rsi": 46.44,
      "macd_signal": "BUY",
      "volume_status": "NORMAL",
      "recommendation": "观望",
      "technical_indicators": {
        "MA5": 1438.98,
        "MA20": 1442.79,
        "MA60": 1452.04,
        "RSI": 46.44,
        "MACD": -6.27,
        "volatility": "1.17%",
        "volume_ratio": 0.70
      }
    }
  }
}
```

### 错误处理

```json
{
  "success": false,
  "error": "错误描述",
  "error_code": "ERROR_CODE",
  "timestamp": "2025-11-12T07:43:54.153256"
}

常见错误码：
  AUTHENTICATION_ERROR: 认证失败
  VALIDATION_ERROR: 参数验证失败
  STOCK_DATA_ERROR: 股票数据获取失败
  INTERNAL_SERVER_ERROR: 服务器内部错误
```

---

## 📚 总结

本系统通过整合7大技术指标，构建了一个完整的股票技术分析平台：

1. **移动平均线 (MA)** - 识别趋势方向
2. **RSI** - 判断超买超卖
3. **MACD** - 捕捉买卖时机
4. **布林带** - 衡量波动范围
5. **成交量** - 验证趋势强度
6. **ATR** - 评估风险水平
7. **ROC** - 反映价格动量

通过综合评分系统，将复杂的技术分析转化为简单的0-100分评分和明确的投资建议，帮助投资者做出更理性的决策。

### 使用建议

1. **不要单独依赖某一个指标**
2. **结合多个指标综合判断**
3. **关注评分系统的综合建议**
4. **根据自身风险承受能力调整策略**
5. **技术分析是辅助工具，不是万能的**

### 免责声明

本系统提供的技术分析和投资建议仅供参考，不构成投资建议。股市有风险，投资需谨慎。请根据自身情况做出投资决策。

---

**文档版本**: v1.0  
**最后更新**: 2025-11-12  
**作者**: RJ.Wang  
**邮箱**: wangrenjun@gmail.com  
**项目地址**: https://github.com/rjwang1982/Stock_lambda

---

© 2025 Stock Analysis API. All rights reserved.
